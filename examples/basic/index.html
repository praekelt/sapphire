<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link
    rel="stylesheet"
    href="../../build/sapphire.css">
    <style type="text/css">
body {
  background: #eee;
}

.sapphire {
}
    </style>
  </head>
  <body>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="https://rawgit.com/justinvdm/strain/master/strain.js"></script>
    <script src="../../build/sapphire.js"></script>
    <script>
var conf = {
  step: 2000,
  limit: 20
};


var metrics = [
  'Foo',
  'Bar',
  'Baz',
  'Quux',
  'Corge',
  'Grault',
  'Garply'
].reduce(function(metrics, name) {
  metrics.set(name, {
    name: name,
    values: []
  });
  
  return metrics;
}, d3.map());


var dashboard = sapphire.dashboard()
  .numcols(10);


dashboard.types().get('last')
  .title(function(d) { return metrics.get(d.metric).name; })
  .values(function(d) { return metrics.get(d.metric).values; });


dashboard.types().get('lines')
  .key(function(d) { return d; })
  .metricTitle(function(d) { return metrics.get(d).name; })
  .values(function(d) { return metrics.get(d).values; });


var el = d3.select('body').append('div')
  .attr('class', 'sapphire')
  .append('div')
  .datum({
    title: 'Random Metrics',
    widgets: [{
      type: 'lines',
      col: 0,
      row: 0,
      colspan: 6,
      title: 'Foo, Bar, Baz and Quux',
      metrics: [
        'Foo',
        'Bar',
        'Baz',
        'Quux'
      ]
    }, {
      type: 'lines',
      col: 0,
      row: 4,
      colspan: 6,
      title: 'Corge, Grault and Garply',
      metrics: [
        'Corge',
        'Grault',
        'Garply',
      ]
    }, {
      type: 'last',
      row: 0,
      col: 6,
      metric: 'Foo',
    }, {
      type: 'last',
      row: 2,
      col: 6,
      metric: 'Bar'
    }, {
      type: 'last',
      row: 4,
      col: 6,
      metric: 'Baz'
    }, {
      type: 'last',
      row: 6,
      col: 6,
      metric: 'Quux'
    }]
  });


update();
setInterval(update, conf.step);


function update() {
  metrics.forEach(function(name, metric) {
    metric.values.push({
      x: +(new Date()),
      y: randint(0, 100000)
    });

    metric.values = metric.values.slice(-conf.limit);
  });

  el.call(dashboard);
}


function randint(lo, hi) {
  return Math.round((Math.random() * (hi - lo)) + lo);
}
    </script>
  </body>
</html>
